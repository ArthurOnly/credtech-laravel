!function(e,t,a,n){"use strict";var r={maxSpeed:20,speed:1,scrollOnMouseOver:!0,resetOnMouseOut:!0,direction:"left"};function s(t,a){this.element=t,this.settings=e.extend({},r,a),this.controller={currentSpeed:0},this.init()}e.extend(s.prototype,{init:function(){var t=this.settings,a=e(this.element);a.wrapInner("<div class='slide-wrap'><div class='slide-data' /></div>");var n=a.find(".slide-data"),r=a.find(".slide-wrap"),s=n.children("ul"),i=this.controller;"right"===t.direction&&(t.speed=-1*t.speed);var l=t.speed;a.addClass("slide-pane");var c=0;s.children().each((function(){e(this).height()>c&&(c=e(this).height())})),r.height(c),s.children().clone().appendTo(s);var o=0;s.children().each((function(){var t=e(this);t.css("left",o),o+=t.outerWidth(!0)}));var u=o/2,d=n.width();setInterval((function(){var e=n.scrollLeft()+i.currentSpeed;e>2*u-d?e-=u:e<0&&(e+=u),n.scrollLeft(e)}),20),this.tweenToNewSpeed(l),t.scrollOnMouseOver&&this.scrollOnMouseOver(n),a.css("visibility","visible")},tweenToNewSpeed:function(t,a){undefined===a&&(a=0),e(this.controller).stop(!0).animate({currentSpeed:t},a)},scrollOnMouseOver:function(a){var n=this.settings,r=this;a.mousemove((function(a){var s=e(t).width()/2,i=a.pageX,l=n.maxSpeed;l*=(i<s?-(100-(i/s*100).toFixed(2)):((i-s)/s*100).toFixed(2))/100,r.tweenToNewSpeed(l)})),n.resetOnMouseOut&&a.mouseout((function(){r.tweenToNewSpeed(n.speed,500)}))}}),e.fn.infiniteScroller=function(t){return this.each((function(){e.data(this,"plugin_infiniteScroller")||e.data(this,"plugin_infiniteScroller",new s(this,t))}))}}(jQuery,window,document);const simulator=document.querySelector(".simulator"),nextButton=document.querySelector("#next-button"),previouslyButton=document.querySelector("#previously-button"),simulateButton=document.querySelector("#simulate-button"),step1=document.querySelector("#step-1"),step2=document.querySelector("#step-2"),step3=document.querySelector("#step-3"),step4=document.querySelector("#step-4"),stepController1=document.querySelector('div[ref="step-1"]'),stepController2=document.querySelector('div[ref="step-2"]'),stepController3=document.querySelector('div[ref="step-3"]');var currentStep=1;function ofAllForms(){[step1,step2,step3,step4].forEach((e=>{e.classList.contains("d-none")||e.classList.add("d-none"),e.classList.contains("active")&&e.classList.remove("active")}))}function ofAllSteps(){[stepController1,stepController2,stepController3].forEach((e=>{e.classList.contains("active")&&e.classList.remove("active")}))}function updateStep(e){switch(ofAllForms(),ofAllSteps(),e){case 1:step1.classList.remove("d-none"),window.setTimeout((()=>step1.classList.add("active")),10),stepController1.classList.add("active"),previouslyButton.classList.add("d-none");break;case 2:step2.classList.remove("d-none"),window.setTimeout((()=>step2.classList.add("active")),10),stepController1.classList.add("active"),stepController2.classList.add("active"),previouslyButton.classList.remove("d-none"),nextButton.classList.remove("d-none"),simulateButton.classList.add("d-none");break;case 3:step3.classList.remove("d-none"),window.setTimeout((()=>step3.classList.add("active")),10),stepController1.classList.add("active"),stepController2.classList.add("active"),stepController3.classList.add("active"),nextButton.classList.add("d-none"),simulateButton.classList.remove("d-none");break;case 4:step4.classList.remove("d-none"),window.setTimeout((()=>step4.classList.add("active")),10),stepController1.classList.add("active"),stepController2.classList.add("active"),stepController3.classList.add("active"),nextButton.classList.add("d-none"),previouslyButton.classList.remove("d-none"),simulateButton.classList.add("d-none")}}previouslyButton.addEventListener("click",(()=>{updateStep(currentStep-=1)})),nextButton.addEventListener("click",(()=>{updateStep(currentStep+=1)}));const sliderAmmount=document.querySelector('input[name="value"]'),labelAmmount=document.querySelector('h5[ref="value"]'),sliderTime=document.querySelector('input[name="parcels"]'),labelTime=document.querySelector('h5[ref="parcels"]'),inputCicle=document.querySelector('select[name="cicle"]');inputCicle.addEventListener("change",(e=>{switch(e.target.value){case"Mensal":sliderTime.setAttribute("max","3"),sliderTime.setAttribute("value","3");break;case"Quinzenal":sliderTime.setAttribute("max","6"),sliderTime.setAttribute("value","6");break;case"Semanal":sliderTime.setAttribute("max","12"),sliderTime.setAttribute("value","12")}labelTime.innerHTML=`${sliderTime.value} vezes`})),sliderAmmount.addEventListener("input",(e=>{labelAmmount.innerHTML=`R$ ${e.target.value}`})),sliderTime.addEventListener("input",(e=>{1!=e.target.value?labelTime.innerHTML=`${e.target.value} vezes`:labelTime.innerHTML=`${e.target.value} vez`}));const form=$("form");function passResultsToFields(e){const t=document.querySelector("#request_value"),a=document.querySelector("#request_parcels"),n=document.querySelector("#request_parcels_value"),r=document.querySelector("#request_iof"),s=document.querySelector("#requested_table"),i=document.querySelector("#request_tax");var l="";switch(e.get("segment_id")){case"1":l="Sem garantia";break;case"2":l="Semi garantia";break;case"3":l="Garantia parcial";break;case"4":l="Garantia integral"}var c="";switch(e.get("segment_id")){case"1":c="Comércio";break;case"2":c="Serviços";break;case"3":c="Indústria";break;case"4":c="Outros"}const o=taxas[c][l][e.get("cicle")],u=calculateParcels(e.get("value"),o,e.get("parcels")),d=e.get("cpf_cnpj").length>14?"juridical":"physical",p=calculateFixedIOF(u,e.get("parcels"),d);var m=0;switch(e.get("cicle")){case"Mensal":m=30;break;case"Quinzenal":m=15;break;case"Semanal":m=7}const v=calculateVariableIOF(u,e.get("parcels"),m,d);r.innerHTML=(v+p).toFixed(2),i.innerHTML=(100*o).toFixed(2),a.innerHTML=e.get("parcels"),n.innerHTML=u,t.innerHTML=e.get("value"),generateTable(s,generateParcelsTable(u,e.get("parcels")))}function generateTable(e,t){e.innerHTML="",t={0:{index:"",value:"Parcela",rest:"Restante"},...t},Object.keys(t).map((a=>{var n=document.createElement("tr"),r=document.createElement("td");const s=t[a].index;r.innerHTML=s;var i=document.createElement("td");const l=`R$ ${t[a].value}`;i.innerHTML=l;var c=document.createElement("td");const o=`R$ ${t[a].rest}`;c.innerHTML=o,n.appendChild(r),n.appendChild(i),n.appendChild(c),e.appendChild(n)}))}form.on("submit",(e=>{e.preventDefault();var t=!1;if(verifyBlanks("form")&&(t=!0),verifyFields("form")&&(t=!0),t)return;const a=new FormData(document.querySelector("form"));a.delete("accept_data"),fetch("http://localhost:8000/api/simulations",{body:a,method:"POST"}),currentStep+=1,updateStep(4),passResultsToFields(a)}));const IOFtaxs={physical:{fixed:.0038,perDay:82e-6},juridical:{fixed:.0038,perDay:41e-6}},taxas={Comércio:{"Sem garantia":{Semanal:.0145,Quinzenal:.034,Mensal:.088},"Semi garantia":{Semanal:.013,Quinzenal:.0325,Mensal:.075},"Garantia parcial":{Semanal:.0099,Quinzenal:.0225,Mensal:.055},"Garantia integral":{Semanal:null,Quinzenal:null,Mensal:.045}},Serviços:{"Sem garantia":{Semanal:.017,Quinzenal:.039,Mensal:.098},"Semi garantia":{Semanal:.015,Quinzenal:.035,Mensal:.085},"Garantia parcial":{Semanal:.0115,Quinzenal:.0248,Mensal:.059},"Garantia integral":{Semanal:null,Quinzenal:null,Mensal:.0499}},Indústria:{"Sem garantia":{Semanal:.012,Quinzenal:.029,Mensal:.078},"Semi garantia":{Semanal:.0105,Quinzenal:.0275,Mensal:.065},"Garantia parcial":{Semanal:.009,Quinzenal:.02,Mensal:.045},"Garantia integral":{Semanal:null,Quinzenal:null,Mensal:.0399}},Outros:{"Sem garantia":{Semanal:.017,Quinzenal:.039,Mensal:.098},"Semi garantia":{Semanal:.015,Quinzenal:.035,Mensal:.085},"Garantia parcial":{Semanal:.0115,Quinzenal:.0248,Mensal:.059},"Garantia integral":{Semanal:null,Quinzenal:null,Mensal:.0499}}};function calculateParcels(e,t,a){return Number((e*((1+t)**a*t/((1+t)**a-1))).toFixed(2))}function generateParcelsTable(e,t){var a=e*t,n={};let r=1;for(;t>0;t-=1)a-=e,n[r]={index:r,value:e.toFixed(2),rest:a.toFixed(2)},r+=1;return n}function calculateFixedIOF(e,t,a){const n=e*t*IOFtaxs[a].fixed;return Number(n.toFixed(2))}function calculateVariableIOF(e,t,a,n){for(var r=e*t,s=0;r>0;)parcelIOF=r*IOFtaxs[n].perDay*a,s+=parcelIOF,r-=e;return Number(s.toFixed(2))}function inputFilesToFormData(e){var t=new FormData;return $(`${e} input,select`).each((function(){const e=$(this).attr("name");var a="";"file"==$(this).attr("type")&&(a=$(this).get(0).files[0],t.append(e,a))})),t}function verifyBlanks(e){var t=!1;return $(`${e} input[require],select[require]`).each((function(){""==$(this).val()||null==$(this).val()?(toggleErrorNode($(this),!0),t=!0):toggleErrorNode($(this),!1)})),t}function verifyFields(e){return $(`${e} input,select`).each((function(){const e=$(this).attr("name"),t=$(this).val();let a;switch(e){case"name":a=!correctName(t),toggleErrorNode($(this),a);break;case"name":a=!correctEmail(t),toggleErrorNode($(this),a);break;case"loan_value":a=!correctLoanVale(t),toggleErrorNode($(this),a,"Valor mínimo R$ 100,00");break;case"cep":!async function(){a=await!correctCEP(t),toggleErrorNode($(this),a)}();break;case"CPF":a=!correctCPF(t),toggleErrorNode($(this),a)}})),!1}function handleUploadFields(){document.querySelectorAll('input[type="file"]').forEach((e=>{const t=document.querySelector(`label[for='${e.getAttribute("id")}'] spam`);e.addEventListener("change",(e=>{t.innerHTML=e.target.value.split(/(\\|\/)/g).pop()}))}))}function handleCheckboxFields(){document.querySelectorAll("div.checkbox").forEach((e=>{const t=e.querySelector("input");t.addEventListener("change",(()=>{t.checked?(e.classList.add("active"),e.parentNode.classList.remove("error")):(e.classList.remove("active"),e.parentNode.classList.add("error"))}))}))}function addMaksInFields(){$('input[name="celphone"]').each((function(){$(this).mask("(00) 00000-0000")}));$('input[name="value"]').each((function(){$(this).mask("000.000.000.000.000,00",{reverse:!0})}));$('input[name="cpf"]').each((function(){$(this).mask("000.000.000-00")}));$('input[name="cnpj"]').each((function(){$(this).mask("00.000.000/0000-00")}));$('input[name="cpf_cnpj"]').each((function(){var e={onKeyPress:function(e,t,a,n){var r=["000.000.000-000","00.000.000/0000-00"],s=e.length<15?r[0]:r[1];$('input[name="cpf_cnpj"]').mask(s,n)}};$(this).mask("000.000.000-000",e)}))}function toggleErrorNode(e,t,a){const n=e.parent();t?(n.addClass("error"),a&&n.find(".error-label p").text(a)):n.removeClass("error")}function correctName(e){return!(null==e||e.lenght<2)}function correctEmail(e){return!(null==e||e.lenght<4||!e.contains("@")||!e.contains("."))}function correctLoanVale(e){return null!=e&&(e=e.replaceAll(".","")),null!=e&&(e=e.replace(",",".")),!((e=Number(e))<100)}async function correctCEP(e){let t=e.replace("-","");t=t||"00000000";return!(await(await fetch(`http://viacep.com.br/ws/${t}/json/`)).json()).erro}function correctCPF(e){var t,a;if(t=0,"00000000000"==(e=(e=e.replaceAll(".","")).replace("-","")))return!1;for(i=1;i<=9;i++)t+=parseInt(e.substring(i-1,i))*(11-i);if(10!=(a=10*t%11)&&11!=a||(a=0),a!=parseInt(e.substring(9,10)))return!1;for(t=0,i=1;i<=10;i++)t+=parseInt(e.substring(i-1,i))*(12-i);return 10!=(a=10*t%11)&&11!=a||(a=0),a==parseInt(e.substring(10,11))}handleUploadFields(),handleCheckboxFields(),addMaksInFields();var strCPF="12345678909";
